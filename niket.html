<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Gradient Sky Cigarette Scene</title>
    <link rel="stylesheet" href="niket.css" />
  </head>
  <body>
    <audio
      id="bg-music"
      src="128-Tum Se Hi - Jab We Met 128 Kbps.mp3"
      loop
      muted
      autoplay
    ></audio>

    <div class="scene" id="scene">
      <div class="ashtray"></div>
      <div class="cigarette">
        <div class="burn-tip"></div>
      </div>

      <div class="nicotex-warning">
        <span>ðŸ˜’ Still smoking? Bro, Nicotex exists ðŸ‘‰ðŸ§ƒ</span>
      </div>

      <div class="nicotex-box" data-word-container-id="nicotexWords1">
        <div class="nicotex-title">âœ¨ Click for Advice (1)</div>
        <div class="nicotex-word-container" id="nicotexWords1"></div>
      </div>

      <div class="nicotex-box" data-word-container-id="nicotexWords2">
        <div class="nicotex-title">âœ¨ Click for Advice (2)</div>
        <div class="nicotex-word-container" id="nicotexWords2"></div>
      </div>

      <div class="nicotex-box" data-word-container-id="nicotexWords3">
        <div class="nicotex-title">âœ¨ Click for Advice (3)</div>
        <div class="nicotex-word-container" id="nicotexWords3"></div>
      </div>
    </div>

    <script>
      const scene = document.getElementById("scene");
      const story = "When the world was silent the smoke spoke for me".split(
        " "
      );
      let index = 0;

      function emitWord() {
        if (index >= story.length) return;
        const word = document.createElement("div");
        word.className = "word";
        word.innerText = story[index];
        word.style.left = 300 + Math.random() * 20 - 10 + "px";
        word.style.fontSize = 16 + Math.random() * 4 + "px";
        scene.appendChild(word);
        setTimeout(() => word.remove(), 6500);
        index++;
      }

      function dropAsh() {
        const ash = document.createElement("div");
        ash.className = "ash";
        scene.appendChild(ash);
        setTimeout(() => ash.remove(), 3000);
      }

      function autoFlow() {
        emitWord();
        dropAsh();
        if (index < story.length) {
          setTimeout(autoFlow, 1400);
        }
      }

      autoFlow();

      document.body.addEventListener("click", (e) => {
        if (!e.target.closest(".nicotex-box")) {
          emitWord();
          dropAsh();
        }
      });

      let lastTime = 0;
      const floatingCards = []; // --- NEW: Create an Audio object for the click sound --- // Ensure this path is correct!

      const cardClickSound = new Audio("zoom-sound-effect-125029.mp3");
      cardClickSound.volume = 1; // Adjust volume (0.0 to 1.0) if needed

      function initializeFloatingCards() {
        const nicotexBoxes = document.querySelectorAll(".nicotex-box");
        const sceneRect = scene.getBoundingClientRect();
        const cardWidth = 240;
        const cardHeight = 160;
        const padding = 50;

        nicotexBoxes.forEach((box, i) => {
          const randomX =
            Math.random() * (sceneRect.width - cardWidth - padding * 2) +
            padding;
          const randomY =
            Math.random() * (sceneRect.height - cardHeight - padding * 2) +
            padding;

          box.style.left = `${randomX}px`;
          box.style.top = `${randomY}px`;

          floatingCards.push({
            element: box,
            x: randomX,
            y: randomY,
            speed: 15 + Math.random() * 10,
            directionAngle: Math.random() * 2 * Math.PI,
          });

          box.addEventListener("click", () => {
            const containerId = box.dataset.wordContainerId;
            triggerNicotexMessage(containerId);
          });
        });

        requestAnimationFrame(animateFloatingCards);
      }

      function animateFloatingCards(currentTime) {
        if (!lastTime) lastTime = currentTime;
        const deltaTime = (currentTime - lastTime) / 1000;
        lastTime = currentTime;

        const sceneWidth = scene.clientWidth;
        const sceneHeight = scene.clientHeight;

        floatingCards.forEach((card) => {
          const { element, x, y, speed, directionAngle } = card;

          const moveX = Math.cos(directionAngle) * speed * deltaTime;
          const moveY = Math.sin(directionAngle) * speed * deltaTime;

          card.x += moveX;
          card.y += moveY;

          const currentWidth = element.clientWidth;
          const currentHeight = element.clientHeight;

          const leftEdge = 0;
          const rightEdge = sceneWidth;
          const topEdge = 0;
          const bottomEdge = sceneHeight;

          if (card.x < leftEdge && Math.cos(directionAngle) < 0) {
            card.directionAngle = Math.PI - directionAngle;
            card.x = leftEdge + 1;
          } else if (
            card.x + currentWidth > rightEdge &&
            Math.cos(directionAngle) > 0
          ) {
            card.directionAngle = Math.PI - directionAngle;
            card.x = rightEdge - currentWidth - 1;
          }

          if (card.y < topEdge && Math.sin(directionAngle) < 0) {
            card.directionAngle = -directionAngle;
            card.y = topEdge + 1;
          } else if (
            card.y + currentHeight > bottomEdge &&
            Math.sin(directionAngle) > 0
          ) {
            card.directionAngle = -directionAngle;
            card.y = bottomEdge - currentHeight - 1;
          }

          element.style.left = `${card.x}px`;
          element.style.top = `${card.y}px`;
        });

        requestAnimationFrame(animateFloatingCards);
      }

      function triggerNicotexMessage(containerId) {
        // --- NEW: Play the click sound here! ---
        cardClickSound.currentTime = 0; // Rewind to start for quick, repeated clicks
        cardClickSound
          .play()
          .catch((e) => console.error("Error playing click sound:", e));

        const words = [
          "No",
          "to",
          "smoke",
          "ðŸ’¨",
          "Use",
          "Nicotex",
          "ðŸ§ƒ",
          "Be",
          "healthy",
          "ðŸ’ª",
          "Live",
          "long",
          "ðŸ’š",
          "Choose",
          "life",
          "âœ¨",
          "Breathe",
          "free",
          "ðŸ˜Š",
          "Feel",
          "good",
          "ðŸ’–",
          "Your",
          "future",
          "ðŸŒŸ",
          "Quit",
          "today",
          "ðŸŒˆ",
          "Better",
          "choices",
          "â¬†ï¸",
          "Healthier",
          "you",
          "ðŸ’–",
        ];
        const container = document.getElementById(containerId);

        container.innerHTML = "";

        const containerRect = container.getBoundingClientRect();
        const originX = containerRect.width / 2;
        const originY = containerRect.height / 2; // Animation duration for each flying word from CSS (bounceAndFade)

        const wordAnimationDurationMs = 2500; // 2.5s // Adjust this value to control how fast words appear after each other // Smaller value = faster succession // Larger value = slower succession

        const wordDelayFactorSeconds = 0.2; // Changed from 0.3 to 0.2 for better flow
        const wordDelayFactorMs = wordDelayFactorSeconds * 1000;

        words.forEach((word, i) => {
          const span = document.createElement("span");
          span.className = "flying-word";
          span.innerText = word;
          span.style.fontSize = `${20 + Math.random() * 15}px`;

          const startRadius = 30;
          const startAngle = Math.random() * 2 * Math.PI;
          const startX = originX + startRadius * Math.cos(startAngle);
          const startY = originY + startRadius * Math.sin(startAngle);

          const endMinRadius = 100;
          const endMaxRadius = 250;
          const endRadius =
            endMinRadius + Math.random() * (endMaxRadius - endMinRadius);
          const endAngle = Math.random() * 2 * Math.PI;
          const endX = originX + endRadius * Math.cos(endAngle);
          const endY = originY + endRadius * Math.sin(endAngle);

          span.style.setProperty("--start-x", `${startX}px`);
          span.style.setProperty("--start-y", `${startY}px`);
          span.style.setProperty("--end-x", `${endX}px`);
          span.style.setProperty("--end-y", `${endY}px`);

          span.style.opacity = "0"; // This sets the delay before THIS word's animation begins
          span.style.animationDelay = `${i * wordDelayFactorSeconds}s`;
          container.appendChild(span); // The word should be removed AFTER its animation has completed. // Removal time = animation duration + its specific animation delay

          setTimeout(
            () => span.remove(),
            wordAnimationDurationMs + i * wordDelayFactorMs
          );
        });

        document.body.classList.add("screen-bounce");
        setTimeout(() => document.body.classList.remove("screen-bounce"), 500);
      }

      document.addEventListener("DOMContentLoaded", initializeFloatingCards);
    </script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const music = document.getElementById("bg-music");

        if (localStorage.getItem("playMusic") === "true") {
          localStorage.removeItem("playMusic"); // clear the flag
          music.muted = false;
          music.play().catch((err) => {
            console.warn("Auto playback failed:", err);
          });
        } else {
          // fallback: play on first user click
          const startMusic = () => {
            music.muted = false;
            music.play().catch((e) => console.error("Playback failed:", e));
            document.removeEventListener("click", startMusic);
          };
          document.addEventListener("click", startMusic);
        }
      });
    </script>
  </body>
</html>
