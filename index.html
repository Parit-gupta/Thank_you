<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thank You</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;500&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <audio id="bg-music" loop>
      <source src="tenderness.mp3" type="audio/mp3" />
    </audio>

    <audio id="click-sound">
      <source src="mouse-click-290204.mp3" type="audio/mp3" />
    </audio>

    <audio id="type-sound">
      <source src="mouse-click-290204.mp3" type="audio/mp3" />
    </audio>

    <div id="author-name" class="top-right-name" style="opacity: 0">
      Parit Gupta
    </div>

    <div id="start-overlay">
      <div class="rgb-glow">
        <button id="start-btn">Start</button>
        <div class="rgb-waves"></div>
      </div>
      <div class="funny-intro-text">
        <p id="funny-line"></p>
      </div>
    </div>

    <div class="image-wrapper">
      <img src="" class="crazy-img" alt="Collage Image 1" />
      <img src="" class="crazy-img" alt="Collage Image 2" />
      <img src="" class="crazy-img" alt="Collage Image 3" />
      <img src="" class="crazy-img" alt="Collage Image 4" />
      <img src="" class="crazy-img" alt="Collage Image 5" />
      <img src="" class="crazy-img" alt="Collage Image 6" />
      <img src="" class="crazy-img" alt="Collage Image 7" />
      <img src="" class="crazy-img" alt="Collage Image 8" />
      <img src="" class="crazy-img" alt="Collage Image 9" />
      <img src="" class="crazy-img" alt="Collage Image 10" />
    </div>

    <div id="intro-overlay">
      <img
        src="WhatsApp Image 2025-06-21 at 01.23.58_812f7b14.jpg"
        alt="Cosmic Void"
      />
    </div>

    <div class="sky">
      <div class="sky-overlay"></div>
      <div class="stars">
        <div class="aurora"></div>
      </div>

      <h1 class="typing">
        Thank You, Didi and Bhaiya for spending time with me!
      </h1>

      <div class="card-container">
        <div class="card">
          <div class="card-image-slider">
            <img src="1691658549571.jpg" alt="Somya 1" />
            <img
              src="WhatsApp Image 2025-06-23 at 18.21.59_e26f18cc.jpg"
              alt="Somya 2"
            />
            <img
              src="WhatsApp Image 2025-06-23 at 18.21.59_e26f18cc.jpg"
              alt="Somya 3"
            />
          </div>
          <h2>Somya Didi</h2>
          <button onclick="openModal('modal1')">Click Here</button>
        </div>

        <div class="card">
          <div class="card-image-slider">
            <img
              src="WhatsApp Image 2025-06-21 at 00.27.58_29b00553.jpg"
              alt="Niket 1"
            />
            <img src="1731613492852.jpg" alt="Niket 2" />
            <img src="1731613492852.jpg" alt="Niket 3" />
          </div>
          <h2>Niket Bhaiya</h2>
          <button onclick="openModal('modal2')">Click Here</button>
        </div>

        <div class="card">
          <div class="card-image-slider">
            <img src="1738405215401.jpg" alt="Anand 1" />
            <img src="1733125014334.jpg" alt="Anand 2" />
            <img
              src="WhatsApp Image 2025-06-23 at 18.22.00_105e5279.jpg"
              alt="Anand 3"
            />
          </div>
          <h2>Anand Bhaiya</h2>
          <button onclick="openModal('modal3')">Click Here</button>
        </div>

        <div class="card">
          <div class="card-image-slider">
            <img
              src="WhatsApp Image 2025-06-23 at 18.22.00_6bbffc67.jpg"
              alt="Sakshi 1"
            />
            <img
              src="WhatsApp Image 2025-06-22 at 00.44.01_fe570723.jpg"
              alt="Sakshi 2"
            />
            <img src="1747112239477.jpg" alt="Sakshi 3" />
          </div>
          <h2>Sakshi Didi</h2>
          <button onclick="openModal('modal4')">Click Here</button>
        </div>
      </div>

      <div id="modal1" class="modal">
        <div class="modal-content">
          <span class="close top-right" onclick="closeModal('modal1')"
            >&times;</span
          >
          <h3>Inspired by Somya Didi</h3>
          <p>
            Her calm approach and deep insights inspired me to stay composed and
            think clearly under pressure.
          </p>

          <div class="photo-gallery">
            <img
              src="WhatsApp Image 2025-06-23 at 18.21.59_e26f18cc.jpg"
              alt="Somya Extra 1"
            />
            <img src="1691658549571.jpg" alt="Somya Extra 2" />
          </div>

          <div class="button-container">
            <button class="btn-somya" onclick="goToSomyaPage()">
              Go to Somya's Page
            </button>
          </div>
        </div>
      </div>

      <div id="modal2" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal2')">&times;</span>
          <h3>Inspired by Niket Bhaiya</h3>
          <p>
            His mentorship taught me the value of clarity, consistency, and
            never giving up when things get tough.
          </p>
          <div class="photo-gallery">
            <img src="1731613492852.jpg" alt="Niket Extra 1" />
            <img
              src="WhatsApp Image 2025-06-21 at 00.27.58_29b00553.jpg"
              alt="Niket Extra 2"
            />
            <div class="button-container">
              <button class="btn-niket" onclick="goToniketPage()">
                Go to Niket's Page
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="modal3" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal3')">&times;</span>
          <h3>Inspired by Anand Bhaiya</h3>
          <p>
            He motivated me with his positive energy and helped me believe in my
            potential and abilities.
          </p>
          <div class="photo-gallery">
            <img
              src="WhatsApp Image 2025-06-23 at 18.22.00_105e5279.jpg"
              alt="Anand Extra"
            />
            <img src="1738405215401.jpg" alt="Anand Extra" />
            <img src="1733125014334.jpg" alt="Anand Extra" />
          </div>
        </div>
      </div>

      <div id="modal4" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal('modal4')">&times;</span>
          <h3>Inspired by Sakshi Didi</h3>
          <p>
            Her leadership and empathy reminded me how powerful kindness is in
            both tech and life.
          </p>
          <div class="photo-gallery">
            <img src="1747112239477.jpg" alt="Sakshi Extra 1" />
            <img src="1746166511054.jpg" alt="Sakshi Extra 2" />
            <img src="1720469259785.jpg" alt="Sakshi Extra 3" />
            <img
              src="WhatsApp Image 2025-06-23 at 18.22.00_6bbffc67.jpg"
              alt="Sakshi Extra 3"
            />
            <img
              src="WhatsApp Image 2025-06-22 at 00.44.01_fe570723.jpg"
              alt="Sakshi Extra 3"
            />
            <div class="button-container">
              <button class="btn-sakshi" onclick="goToSakshiPage()">
                Go to Sakshi's Page
              </button>
            </div>
          </div>
        </div>
      </div>
      <div id="image-popup" class="image-popup">
        <span class="close-popup" onclick="closeImagePopup()">&times;</span>
        <img id="popup-img" src="" alt="Full Size" />
      </div>
    </div>

    <script>
      function openImagePopup(src) {
        const popup = document.getElementById("image-popup");
        const popupImg = document.getElementById("popup-img");
        popupImg.src = src;
        popup.style.display = "flex";
      }

      function closeImagePopup() {
        document.getElementById("image-popup").style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".photo-gallery img").forEach((img) => {
          img.addEventListener("click", () => openImagePopup(img.src));
        });
      });
    </script>

    <script>
      function goToniketPage() {
        localStorage.setItem("playMusic", "true");
        window.location.href = "niket.html";
      }
    </script>

    <script>
      function goToSomyaPage() {
        window.location.href = "Somya.html"; // Make sure this file exists
      }
    </script>

    <script>
      function goToSakshiPage() {
        window.location.href = "Sakshi.html"; // Make sure this file exists
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
      let confettiInstance;

      function openModal(id) {
        const clickSound = document.getElementById("click-sound");
        clickSound.currentTime = 0;
        clickSound
          .play()
          .catch((error) => console.error("Error playing click sound:", error));

        const modal = document.getElementById(id);
        modal.style.display = "flex";

        confettiInstance = setInterval(() => {
          confetti({
            particleCount: 50,
            spread: 120,
            startVelocity: 45,
            origin: { y: 0.8, x: Math.random() },
            colors: ["#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff"],
          });
        }, 150);
        setTimeout(() => clearInterval(confettiInstance), 2500);

        const images = modal.querySelectorAll(".photo-gallery img");
        images.forEach((img) => {
          img.classList.remove("fade-zoom");
          void img.offsetWidth; // Trigger reflow
          img.classList.add("fade-zoom");
        });
      }

      function closeModal(id) {
        const modal = document.getElementById(id);
        const content = modal.querySelector(".modal-content");

        content.classList.add("closing");

        setTimeout(() => {
          modal.style.display = "none";
          content.classList.remove("closing");
        }, 300);

        if (confettiInstance) {
          clearInterval(confettiInstance);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const startBtn = document.getElementById("start-btn");
        const funnyText = document.getElementById("funny-line");
        const intro = document.getElementById("intro-overlay");
        const mainSky = document.querySelector(".sky");
        const bgMusic = document.getElementById("bg-music");
        const typeSound = document.getElementById("type-sound");
        const starsContainer = document.querySelector(".stars");
        const typingHeading = document.querySelector(".typing");
        const authorName = document.getElementById("author-name"); // Get the author name element

        // NEW: Get the image-wrapper and crazy-img elements
        const imageWrapper = document.querySelector(".image-wrapper");
        const crazyImages = imageWrapper.querySelectorAll(".crazy-img");

        let continuousStarInterval;
        let meteorShowerTimeout;
        let meteorShowerActive = false;
        let activeShootingStarsCount = 0;
        let dynamicStylesheet;

        if (document.styleSheets.length === 0) {
          const style = document.createElement("style");
          document.head.appendChild(style);
        }
        dynamicStylesheet = document.styleSheets[0];

        const MIN_STARS_ALWAYS_VISIBLE = 6;
        const METEOR_SHOWER_MIN_BURST = 8;
        const METEOR_SHOWER_MAX_BURST = 15;
        const TOTAL_SHOWER_STARS_CAP = 120;

        // REMOVE the old animateGPImages() if you are not using it.
        // If you want to keep the old one-by-one animation, you'll need to
        // re-evaluate the flow and maybe rename this new function.
        // For now, I'm assuming the new "scattered then grid" is what you want.

        function animateCollageReveal() {
          // Initial state for the collage wrapper
          imageWrapper.style.display = "block"; // Make sure wrapper is visible
          imageWrapper.style.opacity = 0; // Start faded out
          imageWrapper.classList.remove("final-layout"); // Ensure no final layout class initially

          const placedImages = []; // To store the rectangles of placed images

          // Step 1: Random initial positions/sizes before reveal, avoiding overlaps
          crazyImages.forEach((img) => {
            let placed = false;
            let attempts = 0;
            const maxAttempts = 100; // Limit attempts to prevent infinite loops

            while (!placed && attempts < maxAttempts) {
              const size = 150 + Math.random() * 100; // Sizes between 150px and 250px
              // Use a buffer to ensure images don't go off-screen and have some margin
              const buffer = 50;
              const randomTop = Math.floor(
                Math.random() * (window.innerHeight - size - buffer * 2) +
                  buffer
              );
              const randomLeft = Math.floor(
                Math.random() * (window.innerWidth - size - buffer * 2) + buffer
              );

              const newRect = {
                left: randomLeft,
                top: randomTop,
                right: randomLeft + size,
                bottom: randomTop + size,
              };

              let overlaps = false;
              for (const existingRect of placedImages) {
                // Simple AABB collision detection
                if (
                  newRect.left < existingRect.right &&
                  newRect.right > existingRect.left &&
                  newRect.top < existingRect.bottom &&
                  newRect.bottom > existingRect.top
                ) {
                  overlaps = true;
                  break;
                }
              }

              if (!overlaps) {
                img.style.width = size + "px";
                img.style.height = size + "px";
                img.style.top = newRect.top + "px";
                img.style.left = newRect.left + "px";
                img.style.transform =
                  "scale(0.8) rotate(" + (Math.random() * 60 - 30) + "deg)";
                img.style.opacity = 0; // Ensure hidden
                img.style.position = "absolute"; // Ensure absolute for scatter

                placedImages.push(newRect); // Store the successfully placed image's rectangle
                placed = true;
              }
              attempts++;
            }

            // If maxAttempts reached and still overlapping, place it anyway
            if (!placed) {
              // console.warn("Could not find non-overlapping spot for an image after max attempts.");
              // Fallback: Just place it randomly if overlap couldn't be avoided
              const size = 150 + Math.random() * 100;
              img.style.width = size + "px";
              img.style.height = size + "px";
              img.style.top =
                Math.floor(Math.random() * (window.innerHeight - size)) + "px";
              img.style.left =
                Math.floor(Math.random() * (window.innerWidth - size)) + "px";
              img.style.transform =
                "scale(0.8) rotate(" + (Math.random() * 60 - 30) + "deg)";
              img.style.opacity = 0;
              img.style.position = "absolute";
            }
          });

          // Fade in the whole wrapper
          setTimeout(() => {
            imageWrapper.style.opacity = 1;
          }, 100); // Small delay to allow initial setup to apply

          // Step 2: Reveal with animation one by one
          crazyImages.forEach((img, index) => {
            setTimeout(() => {
              img.style.opacity = 1;
              img.style.transform =
                "scale(1) rotate(" + (Math.random() * 30 - 15) + "deg)";
            }, index * 400 + 500); // Staggered reveal + initial delay
          });

          // Step 3: Transition to final fullscreen grid layout after individual animations complete
          const totalIndividualAnimationTime = crazyImages.length * 400;
          const delayBeforeGridTransition = 1500;
          const gridTransitionDuration = 1000;

          setTimeout(() => {
            // Apply the grid layout to the wrapper
            imageWrapper.classList.add("final-layout");

            // Fade out the collage after it has been in the grid layout for a bit
            setTimeout(() => {
              imageWrapper.style.opacity = 0; // Fade out the entire collage
              setTimeout(() => {
                imageWrapper.style.display = "none"; // Hide after fading
                showIntroOverlay(); // Trigger the intro-overlay after collage fades out
                console.log("Collage faded out, moving to intro overlay.");
              }, 1000); // Duration of fade-out
            }, gridTransitionDuration + 2000); // Show collage for 2 seconds in grid before fading out
          }, totalIndividualAnimationTime + delayBeforeGridTransition);
        }

        function showIntroOverlay() {
          const intro = document.getElementById("intro-overlay");
          const mainSky = document.querySelector(".sky");
          const typingHeading = document.querySelector(".typing");

          intro.style.display = "flex"; // Make intro overlay visible
          setTimeout(() => {
            intro.classList.add("active"); // Start fade in

            setTimeout(() => {
              intro.classList.add("fade-out"); // Start fade out

              setTimeout(() => {
                intro.style.display = "none"; // Hide after fade out
                mainSky.classList.add("show"); // Show main sky content
                typingHeading.classList.add("start-typing", "bouncy"); // Start typing animation

                document.querySelectorAll(".floating-text").forEach((ft) => {
                  ft.style.opacity = 1;
                });

                // Show author name here
                authorName.style.opacity = 1;
                authorName.classList.add("show-name"); // Add class for transition

                setTimeout(() => {
                  document
                    .querySelector(".card-container")
                    .classList.add("show-cards");
                }, 4000);

                setTimeout(() => {
                  document.querySelector("footer").classList.add("show-footer");
                }, 6000);

                startContinuousShootingStars();
                scheduleMeteorShower();
              }, 2000); // Delay for intro overlay fade-out
            }, 3000); // Delay before intro starts fading out
          }, 50);
        }

        startBtn.addEventListener("click", async () => {
          try {
            await bgMusic.play();
            console.log("Background music started successfully.");
          } catch (error) {
            console.error("Error playing background music:", error);
            alert(
              "Audio playback failed. Please allow audio for this site or click anywhere to enable sound."
            );
          }

          const funnyLines = [
            "ðŸš€ Launching Feelz Rocket...",
            "ðŸ’– Packing gratitude...",
            "ðŸŽ¯ Target locked: Hearts!",
            "âœ¨ Countdown started...",
            "P.S. Hope you brought snacks!",
            "Brace for maximum appreciation!",
          ];

          let i = 0;

          function typeNext() {
            if (i < funnyLines.length) {
              funnyText.textContent = funnyLines[i];
              typeSound.currentTime = 0;
              typeSound
                .play()
                .catch((error) =>
                  console.error("Error playing type sound:", error)
                );
              i++;
              setTimeout(typeNext, 700);
            } else {
              document.getElementById("start-overlay").style.display = "none";
              animateCollageReveal(); // Call the new collage animation after typing
            }
          }
          typeNext();
        });

        const removeKeyframes = (name) => {
          for (let i = 0; i < dynamicStylesheet.cssRules.length; i++) {
            if (dynamicStylesheet.cssRules[i].name === name) {
              dynamicStylesheet.deleteRule(i);
              break;
            }
          }
        };

        for (let i = 0; i < 8; i++) {
          createGlowingCircle();
        }

        const createShootingStar = (
          customStartX = null,
          customStartY = null,
          customAngle = null,
          customDuration = null
        ) => {
          const shoot = document.createElement("div");
          shoot.classList.add("shooting-star");

          const viewportWidth = window.innerWidth;
          const viewportHeight = window.innerHeight;

          let startX, startY;
          if (customStartX !== null && customStartY !== null) {
            startX = customStartX;
            startY = customStartY;
          } else {
            const edgeChoice = Math.random();
            if (edgeChoice < 0.5) {
              startX = Math.random() * viewportWidth * 0.8;
              startY = -100;
            } else {
              startX = -100;
              startY = Math.random() * viewportHeight * 0.8;
            }
          }

          const angle =
            customAngle !== null ? customAngle : Math.random() * 40 + 30;

          const travelDistance = Math.random() * 1000 + 1500;

          const angleRad = angle * (Math.PI / 180);
          const endX = startX + travelDistance * Math.cos(angleRad);
          const endY = startY + travelDistance * Math.sin(angleRad);

          const duration =
            customDuration !== null
              ? customDuration
              : Math.random() * 1.5 + 3.5;
          const delay = 0;

          const animationName = `shoot-star-${Date.now()}-${Math.random()
            .toString(36)
            .substring(7)}`;

          const keyframesRule = `@keyframes ${animationName} {
                                                from {
                                                    transform: translate(${startX}px, ${startY}px) rotate(${angle}deg);
                                                    opacity: 0.8;
                                                }
                                                to {
                                                    transform: translate(${endX}px, ${endY}px) rotate(${angle}deg);
                                                    opacity: 0;
                                                }
                                            }`;
          try {
            dynamicStylesheet.insertRule(
              keyframesRule,
              dynamicStylesheet.cssRules.length
            );
          } catch (e) {
            console.warn("Failed to insert keyframe rule:", e);
            return;
          }

          shoot.style.animation = `${animationName} ${duration}s linear ${delay}s forwards`;
          shoot.style.width = `${Math.random() * 100 + 150}px`;
          shoot.style.height = `3px`;

          starsContainer.appendChild(shoot);
          activeShootingStarsCount++;

          shoot.addEventListener("animationend", () => {
            shoot.remove();
            activeShootingStarsCount--;
            removeKeyframes(animationName);
          });
        };

        const startContinuousShootingStars = () => {
          continuousStarInterval = setInterval(() => {
            if (
              !meteorShowerActive &&
              activeShootingStarsCount < MIN_STARS_ALWAYS_VISIBLE
            ) {
              createShootingStar();
            } else if (
              meteorShowerActive &&
              activeShootingStarsCount > TOTAL_SHOWER_STARS_CAP + 50
            ) {
              // Safety valve
            }
          }, 300);
        };

        const startMeteorShower = () => {
          if (meteorShowerActive) return;

          meteorShowerActive = true;
          console.log("Meteor Shower START!");

          let showerStarsGenerated = 0;
          const showerBurstInterval = 100;

          const showerRepeater = setInterval(() => {
            if (showerStarsGenerated < TOTAL_SHOWER_STARS_CAP) {
              const starsInThisBurst =
                Math.floor(
                  Math.random() *
                    (METEOR_SHOWER_MAX_BURST - METEOR_SHOWER_MIN_BURST + 1)
                ) + METEOR_SHOWER_MIN_BURST;

              for (let i = 0; i < starsInThisBurst; i++) {
                const startX = Math.random() * window.innerWidth * 0.4;
                const startY = Math.random() * window.innerHeight * 0.3 - 50;
                const angle = Math.random() * 20 + 50;
                const duration = Math.random() * 1 + 2.5;
                const delay = Math.random() * 0.5;
                setTimeout(
                  () => createShootingStar(startX, startY, angle, duration),
                  delay * 1000
                );
              }
              showerStarsGenerated += starsInThisBurst;
            } else {
              clearInterval(showerRepeater);
              meteorShowerActive = false;
              console.log("Meteor Shower END!");
              scheduleMeteorShower();
            }
          }, showerBurstInterval);
        };

        const scheduleMeteorShower = () => {
          const nextShowerDelay = Math.random() * 45000 + 30000;
          meteorShowerTimeout = setTimeout(startMeteorShower, nextShowerDelay);
        };

        function createGlowingCircle() {
          const circle = document.createElement("div");
          circle.classList.add("glowing-circle");

          const size = Math.random() * 40 + 20;
          circle.style.width = `${size}px`;
          circle.style.height = `${size}px`;
          circle.style.left = `${Math.random() * 100}vw`;
          circle.style.top = `${Math.random() * 100}vh`;
          circle.style.animationDelay = `${Math.random() * 2}s`;

          const colors = [
            { base: "255, 0, 153" },
            { base: "0, 200, 255" },
            { base: "255, 255, 0" },
            { base: "144, 238, 144" },
          ];

          const selected =
            colors[Math.floor(Math.random() * colors.length)].base;

          circle.style.background = `radial-gradient(
                                    circle,
                                    rgba(255, 255, 255, 0) 60%,
                                    rgba(${selected}, 0.15) 75%,
                                    rgba(${selected}, 0.3) 85%,
                                    rgba(255, 255, 255, 0) 100%
                                )`;

          document.querySelector(".stars").appendChild(circle);
        }

        for (let i = 0; i < 400; i++) {
          const star = document.createElement("span");
          Object.assign(star.style, {
            position: "absolute",
            width: `${Math.random() * 2 + 1}px`,
            height: `${Math.random() * 2 + 1}px`,
            borderRadius: "50%",
            background: "white",
            top: `${Math.random() * 100}vh`,
            left: `${Math.random() * 100}vw`,
            animation: "blinkStar 2s infinite ease-in-out",
            animationDelay: `${Math.random() * 5}s`,
            opacity: 0.2,
          });
          starsContainer.appendChild(star);
        }

        document.querySelectorAll(".card-image-slider").forEach((slider) => {
          const images = slider.querySelectorAll("img");
          let current = 0;
          if (images.length > 0) {
            images[current].classList.add("active");
          }

          setInterval(() => {
            if (images.length === 0) return;
            images[current].classList.remove("active");
            current = (current + 1) % images.length;
            images[current].classList.add("active");
          }, 2000);
        });

        document.addEventListener("mousemove", (e) => {
          const star = document.createElement("div");
          star.classList.add("cursor-trail-star");
          star.textContent = "â˜…";

          star.style.left = `${e.clientX}px`;
          star.style.top = `${e.clientY}px`;

          document.body.appendChild(star);

          setTimeout(() => {
            star.remove();
          }, 800);
        });
      });
    </script>
  </body>
</html>
